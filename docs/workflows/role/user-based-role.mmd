sequenceDiagram
    participant Admin as Admin (User)
    participant Frontend as Angular App
    participant Backend as Node/Express
    participant MongoDB
    participant Validation as user-role.validation

    %% Admin updates a user role
    Admin->>Frontend: Select user & new role, click "Update Role"
    Frontend->>Backend: PATCH /users/:id/role { newRole } + JWT

    %% Middleware validation
    Backend->>Validation: Check JWT & Admin role
    Validation-->>Backend: Valid JWT & Admin

    %% Step 1: Check if user exists
    Backend->>MongoDB: Find user by ID
    alt User not found
        Backend-->>Frontend: 404 Not Found
        Frontend-->>Admin: Show error
    else User exists
        %% Step 2: Get current role
        Backend->>Backend: currentRole = user.role

        %% Step 3: Validate role progression
        Backend->>Validation: Validate newRole > currentRole
        alt Invalid downgrade
            Backend-->>Frontend: 400 Bad Request ("Cannot downgrade role")
            Frontend-->>Admin: Show error
        else Valid upgrade
            %% Step 4: Update user role
            Backend->>MongoDB: Update user.role = newRole
            MongoDB-->>Backend: Updated user
            Backend-->>Frontend: 200 OK + updated user
            Frontend-->>Admin: Show confirmation
        end
    end
